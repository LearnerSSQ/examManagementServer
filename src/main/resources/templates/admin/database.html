<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>数据库管理 - 考务管理系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <style>
        .database-container {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .action-card {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .action-card h2 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 18px;
        }

        .action-card p {
            color: #666;
            margin-bottom: 15px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: #00b4ff;
            color: white;
        }

        .btn-warning {
            background-color: #ff9800;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .status-message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }

        .status-success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }

        .status-error {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }
    </style>
</head>

<body>
    <div class="database-container">
        <div class="action-card">
            <h2>数据库初始化</h2>
            <p>创建数据库表结构，此操作将重置所有表结构，请谨慎操作。</p>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="initDatabase()">
                    <i class="fas fa-database"></i> 初始化数据库
                </button>
            </div>
            <div id="dbStatus" class="status-message"></div>
        </div>

        <div class="action-card">
            <h2>数据初始化</h2>
            <p>初始化基础数据，包括管理员账号、测试用户等数据。</p>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="initData()">
                    <i class="fas fa-file-import"></i> 初始化数据
                </button>
                <button class="btn btn-warning" onclick="resetData()">
                    <i class="fas fa-redo"></i> 重置数据
                </button>
            </div>
            <div id="dataStatus" class="status-message"></div>
        </div>
    </div>

    <script>
        function showStatus(elementId, success, message) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = 'status-message ' + (success ? 'status-success' : 'status-error');
            statusElement.style.display = 'block';

            // 3秒后自动隐藏
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 3000);
        }

        function initDatabase() {
            if (!confirm('确定要初始化数据库吗？此操作将重置所有表结构！')) {
                return;
            }

            fetch('/api/admin/database/init', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    showStatus('dbStatus', data.code === 200, data.message);
                })
                .catch(error => {
                    showStatus('dbStatus', false, '操作失败：' + error.message);
                });
        }

        function initData() {
            if (!confirm('确定要初始化数据吗？')) {
                return;
            }

            fetch('/api/admin/database/init-data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    showStatus('dataStatus', data.code === 200, data.message);
                })
                .catch(error => {
                    showStatus('dataStatus', false, '操作失败：' + error.message);
                });
        }

        function resetData() {
            if (!confirm('确定要重置数据吗？此操作将清空所有数据！')) {
                return;
            }

            fetch('/api/admin/database/reset-data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    showStatus('dataStatus', data.code === 200, data.message);
                })
                .catch(error => {
                    showStatus('dataStatus', false, '操作失败：' + error.message);
                });
        }
    </script>
</body>

</html>